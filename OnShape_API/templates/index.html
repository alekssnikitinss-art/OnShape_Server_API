<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OnShape BOM Manager</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ OnShape BOM & Bounding Box Manager</h1>
        
        <div class="section">
            <h2>ğŸ” Authentication</h2>
            <div id="userInfo" class="user-info" style="display:none">
                <div>
                    <strong>Logged in as:</strong> <span id="userEmail"></span>
                </div>
                <button onclick="logout()" style="padding: 8px 16px; font-size: 14px;">Logout</button>
            </div>
            <div class="button-group">
                <button id="loginBtn">ğŸ” Login with OnShape</button>
                <button id="loadSavedBtn">ğŸ“‚ Load Saved Documents</button>
            </div>
        </div>
        
        <div class="section">
            <h2>ğŸ“„ Document Information</h2>
            <div class="grid-2">
                <div class="input-group">
                    <label for="documentId">Document ID:</label>
                    <input type="text" id="documentId" placeholder="e.g., 5f4b3c2a1e0d9c8b7a6f5e4d">
                </div>
                <div class="input-group">
                    <label for="workspaceId">Workspace ID:</label>
                    <input type="text" id="workspaceId" placeholder="e.g., 1a2b3c4d5e6f7g8h9i0j">
                </div>
            </div>
            <div class="input-group">
                <label for="elementId">Element ID (Assembly/PartStudio):</label>
                <input type="text" id="elementId" placeholder="e.g., 9z8y7x6w5v4u3t2s1r0q">
            </div>
            <div class="button-group">
                <button id="getDocsBtn">ğŸ“ List My Documents</button>
                <button id="getElemsBtn">ğŸ“„ Get Elements</button>
                <button id="saveDocBtn">ğŸ’¾ Save This Document</button>
            </div>
        </div>
        
        <div class="section">
            <h2>ğŸ” Part Scanner & Metadata Browser</h2>
            <p style="color:#666;margin-bottom:10px">ğŸ’¡ Scan all parts and view their metadata and properties</p>
            
            <div class="button-group">
                <button id="scanPartstudioBtn">ğŸ“¦ Scan PartStudio Parts</button>
                <button id="scanAssemblyBtn">ğŸ—ï¸ Scan Assembly Components</button>
            </div>
            
            <div class="input-group">
                <label for="searchParts">Search Parts:</label>
                <input type="text" id="searchParts" placeholder="Search by name, ID, or property...">
            </div>
            
            <div class="button-group">
                <button id="exportPartsBtn" class="download-btn">â¬‡ï¸ Export Parts List</button>
                <button id="exportMetadataBtn" class="download-btn">â¬‡ï¸ Export All Metadata</button>
            </div>
            
            <div id="partsResults" style="max-height: 700px; overflow-y: auto; margin-top: 15px;"></div>
        </div>
        
        <div class="section">
            <h2>ğŸ“Š Data Operations</h2>
            <div class="toggle-group">
                <label><strong>BOM Format:</strong></label>
                <button class="toggle-btn active" id="flatBtn" onclick="setBomFormat(false)">Flattened</button>
                <button class="toggle-btn" id="structBtn" onclick="setBomFormat(true)">Structured</button>
            </div>
            <div class="button-group">
                <button id="getBomBtn">ğŸ“Š Get BOM</button>
                <button id="getBboxBtn">ğŸ“ Get Bounding Boxes</button>
                <button id="getVarsBtn">ğŸ“‹ Get Configuration Variables</button>
            </div>
            <div class="button-group">
                <button id="createLengthPropsBtn">ğŸ“ Create Length Properties</button>
                <button class="push-btn" id="pushBomBtn" style="display:none">â¬†ï¸ Push BOM to OnShape</button>
            </div>
        </div>
        
        <div class="section">
            <h2>ğŸ“¤ Upload & Edit</h2>
            <div class="input-group">
                <label for="fileUpload">Upload CSV or JSON File:</label>
                <input type="file" id="fileUpload" accept=".csv,.json">
            </div>
            <div class="button-group">
                <button id="clearBtn">ğŸ—‘ï¸ Clear All Data</button>
            </div>
        </div>
        
        <div class="section">
            <h2>ğŸ“¥ Results & Export</h2>
            <div class="button-group">
                <button class="download-btn" id="downloadJsonBtn">â¬‡ï¸ Download JSON</button>
                <button class="download-btn" id="downloadCsvBtn">â¬‡ï¸ Download CSV</button>
            </div>
            <div id="results">No data yet. Login and fetch data or upload a file!</div>
        </div>
    </div>

    <div class="section">
        <h2>ğŸ”„ Unit Conversion & Dimensions</h2>
        <p style="color:#666;margin-bottom:10px">ğŸ’¡ Convert units to MM, add dimensions to BOM, calculate volumes</p>
        
        <!-- Unit Converter -->
        <div class="subsection" style="margin-bottom: 20px; padding: 15px; background: #f0f8ff; border-radius: 8px;">
            <h3>ğŸ“ Unit Converter</h3>
            
            <div class="grid-2">
                <div class="input-group">
                    <label for="convertValue">Value:</label>
                    <input type="number" id="convertValue" placeholder="e.g., 10" value="10">
                </div>
                <div class="input-group">
                    <label for="convertUnit">Unit:</label>
                    <select id="convertUnit">
                        <option value="mm">Millimeters (mm)</option>
                        <option value="cm">Centimeters (cm)</option>
                        <option value="m">Meters (m)</option>
                        <option value="in">Inches (in)</option>
                        <option value="ft">Feet (ft)</option>
                        <option value="yd">Yards (yd)</option>
                    </select>
                </div>
            </div>
            
            <button onclick="convertUnit()" style="background: #667eea;">ğŸ”„ Convert to MM</button>
            <div id="conversionResult" style="margin-top: 10px;"></div>
        </div>
        
        <!-- Volume Calculator -->
        <div class="subsection" style="margin-bottom: 20px; padding: 15px; background: #f0f8ff; border-radius: 8px;">
            <h3>ğŸ“ Volume Calculator (MMÂ³)</h3>
            
            <div class="grid-2">
                <div class="input-group">
                    <label for="lengthMM">Length (mm):</label>
                    <input type="number" id="lengthMM" placeholder="e.g., 100" value="">
                </div>
                <div class="input-group">
                    <label for="widthMM">Width (mm):</label>
                    <input type="number" id="widthMM" placeholder="e.g., 50" value="">
                </div>
            </div>
            
            <div class="input-group">
                <label for="heightMM">Height (mm):</label>
                <input type="number" id="heightMM" placeholder="e.g., 25" value="">
            </div>
            
            <button onclick="calculateVolume()" style="background: #667eea;">ğŸ“ Calculate Volume</button>
            <div id="volumeResult" style="margin-top: 10px;"></div>
        </div>
        
        <!-- Add Dimensions to BOM -->
        <div class="subsection" style="padding: 15px; background: #f0f8ff; border-radius: 8px;">
            <h3>ğŸ“Š Add Dimensions to BOM</h3>
            
            <div style="margin-bottom: 15px;">
                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                    <input type="checkbox" id="useBoundingBoxes" onchange="toggleDimensionMode()">
                    <span>Get dimensions from Bounding Boxes</span>
                </label>
            </div>
            
            <!-- Manual Entry Mode -->
            <div id="manualMode" style="display: block;">
                <h4>Enter dimensions for each BOM item:</h4>
                <p style="color: #666; font-size: 12px;">Enter values like "10 mm", "0.5 in", "5 cm" (space + unit)</p>
                
                <textarea id="lengthInput" placeholder="Length values (one per line, e.g., 10 mm, 20 in, 5 cm)" 
                          style="width: 100%; height: 80px; margin-bottom: 10px; padding: 10px; border: 2px solid #ddd; border-radius: 4px; font-family: monospace;"></textarea>
                
                <textarea id="widthInput" placeholder="Width values (one per line)" 
                          style="width: 100%; height: 80px; margin-bottom: 10px; padding: 10px; border: 2px solid #ddd; border-radius: 4px; font-family: monospace;"></textarea>
                
                <textarea id="heightInput" placeholder="Height values (one per line)" 
                          style="width: 100%; height: 80px; margin-bottom: 10px; padding: 10px; border: 2px solid #ddd; border-radius: 4px; font-family: monospace;"></textarea>
            </div>
            
            <!-- Auto Bounding Boxes Mode -->
            <div id="bboxMode" style="display: none;">
                <p style="background: #e7f3ff; padding: 10px; border-radius: 4px; border-left: 4px solid #667eea;">
                    âœ… Dimensions will be automatically fetched from Bounding Boxes for each part
                </p>
            </div>
            
            <button onclick="addDimensionsToBOM()" style="background: #28a745; width: 100%; padding: 12px;">
                âœ… Add Dimensions to BOM & Calculate Volume
            </button>
            <div id="dimensionResult" style="margin-top: 10px;"></div>
        </div>
        
        <button onclick="showSupportedUnits()" style="margin-top: 10px; background: #6c757d;">ğŸ“‹ Show Supported Units</button>
        <div id="unitsResult" style="margin-top: 10px;"></div>
    </div>

    <!-- Load JavaScript files in correct order -->
    <script src="/static/js/ui.js"></script>
    <script src="/static/js/api.js"></script>
    <script src="/static/js/parts-scanner.js"></script>
    <script src="/static/js/app.js"></script>
</body>
</html>